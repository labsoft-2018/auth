<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1223" height="748" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Title: Customer auth flow - new user
CustomerMobile->Auth: /sign-in-facebook :facebookToken
Auth->*Facebook*: Verify token
*Facebook*->Auth: fbUser
Auth->Credential: get user by fbUser.id
Credential->Auth: null
Auth->User: createUser {:type :customer :email fbUser.email}
User->Auth: user
Auth->Credential: createCredential :user user :type 'facebook' :fb-id fbUser.id
Credential->Auth: credential
Auth->Customer: /create-customer :name fbUser.name :photo fbUser.photo
Customer->Auth: customer
Note over Auth: Generate token for user
Auth->CustomerMobile: 200 token]]></source><desc>Customer auth flow - new user</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"><path d="M10,10C255.3,21.7 130.5,-1.7 302.1,10.0C300.8,17.9 303.4,18.6 302.1,43.0C165.6,31.3 219.4,54.7 10.0,43.0C8.7,15.3 11.3,32.5 10.0,10.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="15" y="29" style="font-size: 16px; font-family: danielbd;"><tspan x="15">Customer auth flow - new user</tspan></text></g><g class="actor"><path d="M10,53C53.1,59.4 35.6,46.6 169.8,53.0C171.5,59.9 168.1,63.3 169.8,96.0C78.9,89.6 35.6,102.4 10.0,96.0C8.3,81.6 11.7,82.4 10.0,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="20" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="20">CustomerMobile</tspan></text></g><g class="actor"><path d="M10,685C144.2,678.6 35.6,691.4 169.8,685.0C171.5,716.1 168.1,691.9 169.8,728.0C128.2,721.6 35.6,734.4 10.0,728.0C11.7,718.5 8.3,704.2 10.0,685.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="20" y="709" style="font-size: 16px; font-family: danielbd;"><tspan x="20">CustomerMobile</tspan></text></g><path d="M89.9,96.0C113.5,300.5 66.3,190.2 89.9,685.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M355.0859375,53C403.5,50.5 395.8,55.5 418.8,53.0C420.5,85.7 417.0,63.3 418.8,96.0C403.5,98.5 378.2,93.5 355.1,96.0C356.8,63.3 353.4,60.3 355.1,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="365.0859375" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="365.0859375">Auth</tspan></text></g><g class="actor"><path d="M355.0859375,685C394.9,687.5 371.2,682.5 418.8,685.0C417.0,707.7 420.5,696.8 418.8,728.0C370.4,725.5 389.6,730.5 355.1,728.0C353.4,691.9 356.8,695.3 355.1,685.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="365.0859375" y="709" style="font-size: 16px; font-family: danielbd;"><tspan x="365.0859375">Auth</tspan></text></g><path d="M386.9,96.0C363.4,277.9 410.5,271.6 386.9,685.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M457.234375,53C532.4,57.5 484.0,48.5 568.6,53.0C570.3,76.2 566.9,63.3 568.6,96.0C541.9,100.5 529.3,91.5 457.2,96.0C459.0,59.9 455.5,63.3 457.2,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="467.234375" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="467.234375">*Facebook*</tspan></text></g><g class="actor"><path d="M457.234375,685C510.7,689.5 497.2,680.5 568.6,685.0C570.3,695.3 566.9,717.7 568.6,728.0C490.6,732.5 530.6,723.5 457.2,728.0C455.5,691.9 459.0,695.3 457.2,685.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="467.234375" y="709" style="font-size: 16px; font-family: danielbd;"><tspan x="467.234375">*Facebook*</tspan></text></g><path d="M512.9,96.0C536.5,468.4 489.3,237.4 512.9,685.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M870.6953125,53C888.2,48.6 940.9,57.4 979.9,53.0C981.6,59.9 978.1,89.1 979.9,96.0C896.9,91.6 953.7,100.4 870.7,96.0C872.4,81.0 869.0,70.9 870.7,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="880.6953125" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="880.6953125">Credential</tspan></text></g><g class="actor"><path d="M870.6953125,685C953.7,680.6 949.3,689.4 979.9,685.0C981.6,702.7 978.1,711.1 979.9,728.0C953.7,723.6 896.9,732.4 870.7,728.0C872.4,697.1 869.0,713.3 870.7,685.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="880.6953125" y="709" style="font-size: 16px; font-family: danielbd;"><tspan x="880.6953125">Credential</tspan></text></g><path d="M925.3,96.0C948.8,590.8 901.7,236.5 925.3,685.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M999.8671875,53C1048.3,50.5 1015.1,55.5 1063.5,53.0C1065.3,71.2 1061.8,61.1 1063.5,96.0C1027.4,93.5 1036.8,98.5 999.9,96.0C998.1,70.8 1001.6,63.3 999.9,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="1009.8671875" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="1009.8671875">User</tspan></text></g><g class="actor"><path d="M999.8671875,685C1017.2,682.5 1015.1,687.5 1063.5,685.0C1065.3,702.6 1061.8,721.1 1063.5,728.0C1015.1,725.5 1020.6,730.5 999.9,728.0C1001.6,700.4 998.1,712.8 999.9,685.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="1009.8671875" y="709" style="font-size: 16px; font-family: danielbd;"><tspan x="1009.8671875">User</tspan></text></g><path d="M1031.7,96.0C1008.1,237.4 1055.3,205.9 1031.7,685.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M1083.5390625,53C1175.5,48.6 1104.2,57.4 1193.1,53.0C1194.8,84.2 1191.4,89.1 1193.1,96.0C1109.8,91.6 1101.1,100.4 1083.5,96.0C1085.3,81.6 1081.8,88.2 1083.5,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="1093.5390625" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="1093.5390625">Customer</tspan></text></g><g class="actor"><path d="M1083.5390625,685C1143.9,689.4 1172.7,680.6 1193.1,685.0C1194.8,692.8 1191.4,700.0 1193.1,728.0C1158.1,723.6 1166.8,732.4 1083.5,728.0C1081.8,717.6 1085.3,721.1 1083.5,685.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="1093.5390625" y="709" style="font-size: 16px; font-family: danielbd;"><tspan x="1093.5390625">Customer</tspan></text></g><path d="M1138.3,96.0C1161.9,516.0 1114.7,313.7 1138.3,685.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="signal"><text x="99.890625" y="123.5" style="font-size: 16px; font-family: danielbd;"><tspan x="99.890625">/sign-in-facebook :facebookToken</tspan></text><path d="M89.9,139.0C233.4,150.9 211.4,127.1 386.9,139.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="396.921875" y="166.5" style="font-size: 16px; font-family: danielbd;"><tspan x="396.921875">Verify token</tspan></text><path d="M386.9,182.0C407.1,187.0 492.7,177.0 512.9,182.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="418.03125" y="209.5" style="font-size: 16px; font-family: danielbd;"><tspan x="418.03125">fbUser</tspan></text><path d="M512.9,225.0C434.7,230.0 482.7,220.0 386.9,225.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="564.4296875" y="252.5" style="font-size: 16px; font-family: danielbd;"><tspan x="560.3671875">get user by fbUser.id</tspan></text><path d="M386.9,268.0C796.1,289.5 738.3,246.5 925.3,268.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="641.828125" y="295.5" style="font-size: 16px; font-family: danielbd;"><tspan x="641.828125">null</tspan></text><path d="M925.3,311.0C711.6,289.5 531.0,332.5 386.9,311.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="498.0703125" y="338.5" style="font-size: 16px; font-family: danielbd;"><tspan x="498.0703125">createUser {:type :customer :email fbUser.email}</tspan></text><path d="M386.9,354.0C752.5,328.2 873.4,379.8 1031.7,354.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="690.265625" y="381.5" style="font-size: 16px; font-family: danielbd;"><tspan x="690.265625">user</tspan></text><path d="M1031.7,397.0C681.7,371.2 490.1,422.8 386.9,397.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="396.921875" y="424.5" style="font-size: 16px; font-family: danielbd;"><tspan x="396.921875">createCredential :user user :type 'facebook' :fb-id fbUser.id</tspan></text><path d="M386.9,440.0C549.4,461.5 473.1,418.5 925.3,440.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="615.5625" y="467.5" style="font-size: 16px; font-family: danielbd;"><tspan x="615.5625">credential</tspan></text><path d="M925.3,483.0C721.0,461.5 839.1,504.5 386.9,483.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="508.50390625" y="510.5" style="font-size: 16px; font-family: danielbd;"><tspan x="508.50390625">/create-customer :name fbUser.name :photo fbUser.photo</tspan></text><path d="M386.9,526.0C988.6,495.9 744.3,556.1 1138.3,526.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="721.90234375" y="553.5" style="font-size: 16px; font-family: danielbd;"><tspan x="721.90234375">customer</tspan></text><path d="M1138.3,569.0C958.0,599.1 567.3,538.9 386.9,569.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="note"><path d="M273.9140625,589C380.1,580.0 390.2,598.0 499.9,589.0C498.6,614.1 501.2,600.0 499.9,622.0C463.8,631.0 390.3,613.0 273.9,622.0C272.6,614.1 275.2,616.7 273.9,589.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="278.9140625" y="608" style="font-size: 16px; font-family: danielbd;"><tspan x="278.9140625">Generate token for user</tspan></text></g><g class="signal"><text x="189.96875" y="649.5" style="font-size: 16px; font-family: danielbd;"><tspan x="189.96875">200 token</tspan></text><path d="M386.9,665.0C226.4,653.1 161.2,676.9 89.9,665.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g></svg>