<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="920" height="576" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Title: Merchant registration flow
MerchantWebapp->Auth: /register :email :password :type merchant
Auth->User: createUser
User->Auth: user
Auth->Credentials: createCredential
Credentials->Auth: credential
Auth->Merchant: /create-merchant
Merchant->Auth: merchant
Note over Auth: Generate token for user
Auth->MerchantWebapp: 200 token

# Note: if create-merchant fails, we should revert the created user and credential]]></source><desc>Merchant registration flow</desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"><path d="M10,10C192.6,0.3 105.3,19.7 252.9,10.0C254.2,36.8 251.6,32.9 252.9,43.0C168.7,33.3 68.3,52.7 10.0,43.0C8.7,18.8 11.3,32.5 10.0,10.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="15" y="29" style="font-size: 16px; font-family: danielbd;"><tspan x="15">Merchant registration flow</tspan></text></g><g class="actor"><path d="M10,53C92.0,59.5 49.1,46.5 173.0,53.0C171.3,75.3 174.8,59.9 173.0,96.0C133.9,89.5 73.8,102.5 10.0,96.0C11.7,83.8 8.3,65.4 10.0,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="20" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="20">MerchantWebapp</tspan></text></g><g class="actor"><path d="M10,513C145.3,519.5 68.9,506.5 173.0,513.0C171.3,549.1 174.8,524.8 173.0,556.0C133.9,549.5 63.9,562.5 10.0,556.0C11.7,521.1 8.3,548.7 10.0,513.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="20" y="537" style="font-size: 16px; font-family: danielbd;"><tspan x="20">MerchantWebapp</tspan></text></g><path d="M91.5,96.0C108.2,334.8 74.8,162.7 91.5,513.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M445.515625,53C460.8,55.5 457.0,50.5 509.2,53.0C510.9,68.3 507.5,79.7 509.2,96.0C493.9,93.5 499.0,98.5 445.5,96.0C447.2,83.0 443.8,85.7 445.5,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="455.515625" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="455.515625">Auth</tspan></text></g><g class="actor"><path d="M445.515625,513C463.5,515.5 493.9,510.5 509.2,513.0C507.5,542.4 510.9,540.2 509.2,556.0C462.4,553.5 478.4,558.5 445.5,556.0C443.8,525.8 447.2,545.7 445.5,513.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="455.515625" y="537" style="font-size: 16px; font-family: danielbd;"><tspan x="455.515625">Auth</tspan></text></g><path d="M477.4,96.0C494.0,420.6 460.7,256.4 477.4,513.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M568.5234375,53C606.8,55.5 590.3,50.5 632.2,53.0C633.9,74.7 630.5,59.9 632.2,96.0C612.5,93.5 616.9,98.5 568.5,96.0C570.2,84.6 566.8,63.4 568.5,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="578.5234375" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="578.5234375">User</tspan></text></g><g class="actor"><path d="M568.5234375,513C583.8,515.5 602.4,510.5 632.2,513.0C633.9,549.1 630.5,519.9 632.2,556.0C596.5,553.5 602.6,558.5 568.5,556.0C570.2,519.9 566.8,523.3 568.5,513.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="578.5234375" y="537" style="font-size: 16px; font-family: danielbd;"><tspan x="578.5234375">User</tspan></text></g><path d="M600.4,96.0C617.0,443.0 583.7,162.7 600.4,513.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M652.1953125,53C750.9,48.3 713.5,57.7 769.7,53.0C768.0,66.1 771.4,59.9 769.7,96.0C671.0,100.7 680.4,91.3 652.2,96.0C650.5,63.3 653.9,66.0 652.2,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="662.1953125" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="662.1953125">Credentials</tspan></text></g><g class="actor"><path d="M652.1953125,513C680.4,517.7 706.4,508.3 769.7,513.0C771.4,539.9 768.0,539.8 769.7,556.0C741.5,551.3 700.2,560.7 652.2,556.0C650.5,542.3 653.9,533.4 652.2,513.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="662.1953125" y="537" style="font-size: 16px; font-family: danielbd;"><tspan x="662.1953125">Credentials</tspan></text></g><path d="M711.0,96.0C694.3,162.7 727.6,446.3 711.0,513.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="actor"><path d="M789.7265625,53C848.0,49.0 811.9,57.0 890.3,53.0C892.0,67.8 888.6,75.0 890.3,96.0C852.3,100.0 857.4,92.0 789.7,96.0C791.4,73.4 788.0,75.0 789.7,53.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="799.7265625" y="77" style="font-size: 16px; font-family: danielbd;"><tspan x="799.7265625">Merchant</tspan></text></g><g class="actor"><path d="M789.7265625,513C829.5,509.0 813.9,517.0 890.3,513.0C888.6,525.0 892.0,549.1 890.3,556.0C810.8,552.0 845.3,560.0 789.7,556.0C788.0,545.5 791.4,545.7 789.7,513.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="799.7265625" y="537" style="font-size: 16px; font-family: danielbd;"><tspan x="799.7265625">Merchant</tspan></text></g><path d="M840.0,96.0C856.7,280.4 823.3,412.9 840.0,513.0" stroke="#000000" fill="none" style="stroke-width: 2;"></path><g class="signal"><text x="101.5234375" y="123.5" style="font-size: 16px; font-family: danielbd;"><tspan x="101.5234375">/register :email :password :type merchant</tspan></text><path d="M91.5,139.0C373.7,154.4 153.3,123.6 477.4,139.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="490.77734375" y="166.5" style="font-size: 16px; font-family: danielbd;"><tspan x="490.77734375">createUser</tspan></text><path d="M477.4,182.0C538.2,177.1 546.2,186.9 600.4,182.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="519.80859375" y="209.5" style="font-size: 16px; font-family: danielbd;"><tspan x="519.80859375">user</tspan></text><path d="M600.4,225.0C570.8,220.1 506.9,229.9 477.4,225.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="523.328125" y="252.5" style="font-size: 16px; font-family: danielbd;"><tspan x="523.328125">createCredential</tspan></text><path d="M477.4,268.0C673.6,258.7 586.4,277.3 711.0,268.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="553.6171875" y="295.5" style="font-size: 16px; font-family: danielbd;"><tspan x="553.6171875">credential</tspan></text><path d="M711.0,311.0C514.7,320.3 537.1,301.7 477.4,311.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="582.72265625" y="338.5" style="font-size: 16px; font-family: danielbd;"><tspan x="582.72265625">/create-merchant</tspan></text><path d="M477.4,354.0C782.0,368.5 753.0,339.5 840.0,354.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="signal"><text x="617.84765625" y="381.5" style="font-size: 16px; font-family: danielbd;"><tspan x="617.84765625">merchant</tspan></text><path d="M840.0,397.0C636.3,411.5 557.8,382.5 477.4,397.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g><g class="note"><path d="M364.34375,417C428.8,426.0 407.1,408.0 590.4,417.0C589.0,436.8 591.7,440.3 590.4,450.0C554.2,441.0 536.1,459.0 364.3,450.0C363.0,442.1 365.7,424.9 364.3,417.0" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></path><text x="369.34375" y="436" style="font-size: 16px; font-family: danielbd;"><tspan x="369.34375">Generate token for user</tspan></text></g><g class="signal"><text x="236" y="477.5" style="font-size: 16px; font-family: danielbd;"><tspan x="236">200 token</tspan></text><path d="M477.4,493.0C307.6,508.4 153.3,477.6 91.5,493.0" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></path></g></svg>